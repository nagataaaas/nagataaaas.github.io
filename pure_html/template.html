<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ながた の やるだけPython</title>

    <!--syntax highlight-->
    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>


    <!--brython-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.9.2/brython.min.js"
            integrity="sha512-vZbQ0CAHrWkDIyn3VQejez+lxdSvsWuJhrWQVK+g+U3oQ3TM9K63rAwbI+iODLLNbnPkz3qzKkxGyD8PMhViPw=="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.9.2/brython_stdlib.min.js"
            integrity="sha512-JJ4ZmaIr9EoCSB5XQBafIuJ8ucSeg9UxAWhYpecDk4kC3azdP028eKKnXHLy/8KKg9zp77tjHCwTyJZoRl0vqg=="
            crossorigin="anonymous"></script>
    
    <!--style-->
    <link rel="stylesheet" href="static/style.css">
    <link rel="stylesheet" href="static/dracula.css">
</head>
<body onLoad="brython(1)">
<h1 id="title">やるだけPython</h1>
<h3 id="author">Yamato Nagata</h3>
<h3 id="email"><a href="mailto:chickenwingswillfly@gmail.com">chickenwingswillfly@gmail.com</a></h3>
<h3>last update: {{update}}</h3>
<hr>
<ul>
    <li><a href="index.html#1-">このページの目的</a></li>
    <li><a href="index.html#2-">本サイトの流れ</a></li>
</ul>

<hr>
{{content}}
<script type="text/python3">
import sys
from interpreter import Interpreter

from browser import window, document, html, highlight
def run(ev):
    before_height = int(window.document.documentElement.scrollTop)
    window.document.documentElement.scrollTop = 0
    while not document.querySelector('textarea'):
        try:
            while document.querySelector('.brython-dialog-main'):
                document.querySelector('.brython-dialog-main').remove()
            Interpreter()

            class MyOutput:
                def __init__(self):
                    self.console = document.querySelector('textarea')

                def write(self, text):
                    self.console.value += text

            sys.stdout = MyOutput()
            break
        except:
            pass

    window.document.documentElement.scrollTop = before_height
    interpreter = document.querySelector('textarea')
    interpreter.spellcheck = False

    interpreter.value = '>>> '
    for line in ev.target.elt.text.strip().split('\n'):
        if line.strip().startswith('#'):
            continue
        interpreter.value += line
        event = window.KeyboardEvent.new("keypress", {'keyCode': 13})
        interpreter.dispatchEvent(event)

for btn in document.select('.run-button'):
    btn.bind('click', run)
    # set attribute python_code, used when button is hit
    btn.elt = btn.nextElementSibling

</script>

</body>
</html>